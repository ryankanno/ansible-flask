---
  - hosts: web
    sudo: yes
    roles:
      - nginx
      - uwsgi
      - supervisor
    post_tasks:
      - name: web | configure_application.yml | create application directory
        file: state=directory path={{ flask_application.target.path }} owner={{ flask_application.user }} group={{ flask_application.group }}

      - name: web | configure_application.yml | create virtualenvs directory
        file: state=directory path={{ flask_application.target.venvs_path }} owner={{ flask_application.user }} group={{ flask_application.group }}

  - include: deploy.yml

  - hosts: web
    sudo: yes
    tasks:
      - name: site | site.yml | restart application
        supervisorctl: name={{ deploy.supervisor.group }} state=restarted config=/etc/supervisor/supervisord.conf
        when: deploy.supervisor.group is defined and not((deploy.supervisor.group is none) or (deploy.supervisor.group|trim == ''))
